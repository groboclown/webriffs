<!-- TODO merge the branch playback and the branch edit -->

<div>
<a ng-href="#/film/view/{{cmp.filmId}}" ng-if="cmp.loaded">Film Details</a>
<a ng-href="#/branch/changes/{{cmp.branchId}}" ng-if="cmp.branchId != null">Branch History</a>
</div>

<div ng-if="! cmp.canReadQuips && cmp.loaded">
You do not have permissions to view the contents of this branch.
<div class="bug">BUG this message may be incorrectly shown while the page is loading.</div>
</div>

<div ng-if="cmp.canReadQuips" class="component">
    
    <div ng-if="cmp.loaded">
        <div><span>{{cmp.filmName}}</span> <span>({{cmp.filmReleaseYear}})</span>
            <span ng-if="cmp.urlChangeId &gt;= 0">(revision {{cmp.changeId}})</span>
            <span ng-if="cmp.urlChangeId &lt; 0">(pending changes)</span>
        </div>
        <div>{{cmp.branchName}}</div>
        <div>{{cmp.description}}</div>
        <div>Last updated on {{cmp.updatedOn}}</div>
    </div>
    <div ng-if="! cmp.loaded">
        <span ng-if="cmp.loadError">Problem loading branch.  You may not have
        permission to see it, or it may not exist.</span>
        <span ng-if="! cmp.loadError">loading...</span>
    </div>

    <branch-updates current-branch="cmp.branchDetails"></branch-updates>
    
    <media-controller
        time="cmp.videoTimeProvider"
        controller="cmp.mediaAlertController"
        branch-details="cmp.branchDetails"></media-controller>
    
    
    <!-- Edit the quip -->
    <div ng-if="cmp.canEditQuips">
        Edit quip:
        <form onsubmit="return false;">
        <div>
            <label for="quip_time">When </label>
            <input id="quip_time" type="text" ng-model="cmp.quipTime">
            <button ng-click="cmp.setPendingQuipTime()">Set from player</button>
        </div>
        <div>
            <label for="quip_text">With </label>
            <input id="quip_text" type="text" ng-model="cmp.quipText">
        </div>
        <div>
            <input type="submit" ng-click="cmp.savePendingQuip()" value="Save">
        </div>
        </form>
    </div>
    <div ng-if="!cmp.canEditQuips">
    Can't edit quips.
    <span ng-if="cmp.isEditable">But branch is editable?</span>
    </div>
        
    <div>
        <!-- filter controls -->
    </div>
    <table>
        <thead>
            <tr>
                <th ng-if="cmp.isEditable">&nbsp;</th>
                <th>Time</th>
                <th>Text</th>
                <th>Tags</th>
            </tr>
        </thead>
        <tbody ng-if="cmp.quipPaging.loading">
            <tr>
                <td colspan="3">loading ...</td>
            </tr>
        </tbody>
        <tbody ng-if="cmp.quipPaging.loadedSuccessful">
            <tr ng-repeat="quip in cmp.quipPaging.quips">
                <td ng-if="cmp.isEditable"
                    ng-click="cmp.editQuip(quip)">&#9998;</td>
                <td>{{quip.timestamp}}</td>
                <td>{{quip.text}}</td>
                <td>
                    <span ng-repeat="tag in quip.tags">
                        {{tag.name}}
                    </span>
                </td>
            </tr>
        </tbody>
    </table>
</div>
