<!-- TODO merge the branch playback and the branch edit -->

<div>
<a ng-href="#/film/view/{{cmp.filmId}}" ng-if="cmp.loaded">Film Details</a>
<a ng-href="#/branch/changes/{{cmp.branchId}}" ng-if="cmp.branchId != null">Branch History</a>
</div>

<div ng-if="! cmp.canReadQuips">
You do not have permissions to view the contents of this branch.
</div>

<div ng-if="cmp.canReadQuips && ! cmp.canEditQuips">
Unfortunately, you don't have permissions to edit the contents of this branch.
</div>

<div ng-if="cmp.canEditQuips">
    
    <div ng-if="cmp.loaded">
        <div><span>{{cmp.filmName}}</span> <span>({{cmp.filmReleaseYear}})</span>
            <span ng-if="cmp.urlChangeId &gt; 0">(revision {{cmp.changeId}})</span>
        </div>
        <div>{{cmp.branchName}}</div>
        <div>{{cmp.description}}</div>
        <div>Last updated on {{cmp.updatedOn}}</div>
    </div>
    <div ng-if="! cmp.loaded">
        <span ng-if="cmp.loadError">Problem loading branch.  You may not have
        permission to see it, or it may not exist.</span>
        <span ng-if="! cmp.loadError">loading...</span>
    </div>

    <branch-updates current-branch="cmp.branchDetails"></branch-updates>
    
    <media-controller
        connector="cmp.mediaStatusService"
        branch-details="cmp.branchDetails"></media-controller>
    
    <edit-quip
        branch="cmp.branchDetails"
        media="cmp.mediaStatusService"
        updates="cmp.quipChangedEvents"></edit-quip>
    <div>
        <!-- filter controls -->
    </div>
    <page-control page-state="cmp.quipPaging">
        <table>
            <thead>
                <tr>
                    <!-- FIXME add sorting controls -->
                    <th>Time</th>
                    <th>Text</th>
                    <th>Tags</th>
                </tr>
            </thead>
            <tbody ng-if="cmp.quipPaging.loadedSuccessful">
                <tr ng-repeat="quip in cmp.quips">
                    <!-- FIXME handle committed timestamp -->
                    <td>{{quip.timestamp}}</td>
                    <td>{{quip.text}}</td>
                    <td>
                        <span ng-repeat="tag in quip.tags">
                            {{tag.name}}
                        </span>
                    </td>
                </tr>
            </tbody>
        </table>
    </page-control>
</div>
